== Lab 4: Red Hat AdvancedClusterSecurity ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®è‡ªå‹•åŒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å®Ÿè£…ã¨DevSecOpsã®æ§‹ç¯‰

=== ãƒ©ãƒœã®ç›®çš„

ã“ã®ãƒ©ãƒœã®ç›®æ¨™ã¯ã€ã•ã¾ã–ã¾ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›ã‚’ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã€å®‰å…¨ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ•ã‚¡ã‚¯ãƒˆãƒªã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã“ã¨ã§ã™ã€‚DevSecOps ã®å‡ºç¾ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯å‰é¢ã¨ä¸­å¿ƒã«ç½®ã‹ã‚Œã€äººã€ãƒ—ãƒ­ã‚»ã‚¹ã€ãŠã‚ˆã³ã€æŠ€è¡“ã®é¢ã§å¯¾å‡¦ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¯ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã«çµ±åˆã•ã‚Œã¦ãŠã‚Šã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã¾ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚²ãƒ¼ãƒˆã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ãŒæº€ãŸã•ã‚Œãªã„å ´åˆã€ãƒ“ãƒ«ãƒ‰ã‚’ç°¡å˜ã«ä¸­æ–­ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

=== åºç« 

DevOpsã¨ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼ï¼ˆCI/CDï¼‰ã®åˆ©ç‚¹ã¯ã€é•·å¹´ã«ã‚ãŸã£ã¦å¤§ããªæˆæœã¨ã¨ã‚‚ã«å®Ÿè¨¼ã•ã‚Œã¦ãã¾ã—ãŸã€‚çµ„ç¹”ã¯å¸¸ã«ã€ã‚ˆã‚Šå°‘ãªã„äººæ•°ã§ã‚ˆã‚Šå¤šãã®ã“ã¨ã‚’è¡Œã†ã“ã¨ã‚’æ±‚ã‚ã¦ãã¾ã—ãŸã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯å¤šãã®å ´åˆã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢æä¾›ãƒ—ãƒ­ã‚»ã‚¹ã®æœ«ç«¯ã®ã‚¢ãƒ‰ã‚ªãƒ³ã¨ã—ã¦æ‰±ã‚ã‚Œã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªã®é…å»¶ã«ã¤ãªãŒã‚‹ã“ã¨ã‚‚å°‘ãªãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ¥­ç•Œã¯ã€ã“ã‚Œã‚’å¤‰ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã‚’èªè­˜ã—ã¾ã—ãŸã€‚çµ„ç¹”ã¯ã€å¥‘ç´„ä¸ŠãŠã‚ˆã³è¦åˆ¶ä¸Šã®ç¾©å‹™ã‚„ç¤¾å†…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¨™æº–ã‚’å¼•ãç¶šãæº€ãŸã™å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€æ©Ÿä¼šã‚’ç”Ÿã‹ã™ãŸã‚ã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªã‚’åŠ é€Ÿã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚çµ„ç¹”ãŒã“ã‚Œã‚‰ã®æ¨™æº–ã‚’æº€ãŸã—ã€DevOpsã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã§ãƒ‡ãƒªãƒãƒªãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã€ç„¡é–¢ä¿‚ã«ãªã‚‹ã‹ã€æœ€æ–°ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«é©åˆã™ã‚‹ã‹ã®é¸æŠã«è¿«ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è¿…é€Ÿã«æä¾›ã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã‚ã‚Šã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å“è³ªã®æŒ‡æ¨™ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€"DevOps" ã« "Sec" ã‚’å«ã‚ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚DevSecOpsã®ç™»å ´ã«ã‚ˆã‚Šã€Shift Leftã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒªãƒãƒªãƒ—ãƒ­ã‚»ã‚¹ã®æ—©ã„æ®µéšã§ä¸å…·åˆã‚’ç™ºè¦‹ã—ã€é˜²æ­¢ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ãªã‚Šã¾ã—ãŸã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã«ç›´æ¥çµ±åˆã•ã‚Œã¾ã™ã€‚ãã®çµæœã€CI/CDãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚ˆã‚Šé€Ÿãé€²ã‚ã€ãƒ‡ãƒªãƒãƒªãƒ¼ã¾ã§ã®æœŸé–“ã‚’çŸ­ç¸®ã—ãªãŒã‚‰ã€å„ãƒªãƒªãƒ¼ã‚¹ã®å“è³ªã‚’ç¶™ç¶šçš„ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ã€‚+
ã“ã®å®Ÿç¿’ã§ã¯ã€å…¸å‹çš„ãª CI/CD ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹åˆ¶å¾¡ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹æŠ€è¡“ã®ã„ãã¤ã‹ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚ +
DevSecOps ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã€å¤šãã®ãƒ„ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€äº‹å‰ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®ã»ã¨ã‚“ã©ã¯ã€Red Hat OpenShift ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã§ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚Œã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€ç§ãŸã¡ã®ãƒ©ãƒœã§ã‚¹ãƒ†ãƒƒãƒ—ã‚¹ãƒ«ãƒ¼ã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã™:

image:images/lab4-devsecops01.png[800,800]

DevSecOpsã®CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€æ¬¡ã®ã‚ˆã†ãªæŠ€è¡“ã‚’ä½¿ç”¨ã—ã¾ã™:

- https://tekton.dev[Tekton] ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ https://www.openshift.com/learn/topics/ci-cd[OpenShift Pipelines] 
- https://argoproj.github.io/[ArgoCD] ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ https://www.openshift.com/blog/announcing-openshift-gitops[OpenShift GitOps]
- https://www.redhat.com/en/resources/advanced-cluster-security-for-kubernetes-datasheet[Red Hat Advanced Cluster Security for Kubernetes]
- https://docs.openshift.com/container-platform/latest/registry/architecture-component-imageregistry.html[OpenShift Container Registry]
- https://www.sonarqube.org/[SonarQube]
- https://www.sonatype.com/products/repository-oss?topnav=true[Nexus]
- https://junit.org/junit5/[JUnit]
- https://gogs.io/[Gogs]
- https://tekton.dev/docs/triggers/[Git Webhook]
- https://gatling.io/[Gatling]
- https://www.zaproxy.org/[Zap Proxy]

[#beforeyoustart]
=== å§‹ã‚ã‚‹å‰ã«

è¬›å¸«ã‹ã‚‰ã®æƒ…å ±ã¯ã€ã“ã®ãƒ©ãƒœã§ä½¿ç”¨ã•ã‚Œã¾ã™:

- RHEL 8 VM (bastion)ã¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹
- OpenShift ã‚³ãƒ³ã‚½ãƒ¼ãƒ« URL
- OpenShift API ã‚µãƒ¼ãƒ
- OpenShift ç®¡ç†è€…ã®ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

ä»¥ä¸‹ã¯ç™»éŒ²æƒ…å ±ã®ä¸€ä¾‹ã§ã™:

image:images/lab4-devsecops02.png[800,800]

=== ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦ä»¶

- æœ€æ–°ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼: Chromeã¨Firefoxã‚’æ¨å¥¨
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¨'oc'ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ©ãƒœã«ä»˜å±ã—ã¦ã„ã‚‹Bastion VMã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

* ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã®ã‚ˆã†ã«ã€å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸ VM ã« SSH æ¥ç¶šã—ã¾ã™:
+
[source]
----
 ssh lab-user@bastion.GUID.sandbox####.opentlc.com
----
+
* oc ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒä½¿ç”¨å¯èƒ½ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:
+
[source]
----
 oc version
----
+
* ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã® URL ã‚’å–å¾—ã™ã‚‹å ´åˆ:
+
[source]
----
oc login -u admin api.cluster-{GUID}.{GUID}.sandbox###.opentlc.com:6443
----
+
â€˜oc loginâ€™ ã®APIã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã¯ã€xref:beforeyoustart[å§‹ã‚ã‚‹å‰ã«] ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
+
* ã¾ãŸã€ãƒ©ãƒƒãƒ—ãƒˆãƒƒãƒ—ã§ocã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™:
+
** OpenShift ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚OpenShiftã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æƒ…å ±ã¯ã€è¬›å¸«ã‹ã‚‰æä¾›ã•ã‚Œã¾ã™ã€‚
å³ä¸Šã®ã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³ãƒãƒ¼ã‚¯ã‚’é¸æŠã—ã€â€œCommand Line Toolsâ€ ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:images/lab4-devsecops03.png[200,200]
+
** é¸æŠã—ãŸã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ç”¨ã®ocã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
** ocã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã«ç§»å‹•ã—ã¦ãŠãã¨ã€æ¼”ç¿’ä¸­ã«ç°¡å˜ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
+
ä¾‹ãˆã°Macbookã®å ´åˆã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
+
|===
|mv <insert-download-path> /usr/local/bin /usr/local/bin/
|===
+
* ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šå¯èƒ½ãªãƒ©ãƒœç’°å¢ƒ
* GitHub ã¸ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹

=== Lab 4.1 ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã®æœ€åˆã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€OpenShift Pipeline ã‚’å®Ÿè¡Œã—ã€ã‚µãƒ³ãƒ—ãƒ«ã®å®‰å…¨ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ¢ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ +
ã“ã®ãƒ©ãƒœã§ã¯ã€Tekton ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®é–‹å§‹æ–¹æ³•ã¨ã€é–‹ç™ºãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å†…ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ gitops ãƒ„ãƒ¼ãƒ«ã‚’çµ±åˆã™ã‚‹ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã®ä½¿ç”¨æ–¹æ³•ã‚’å­¦ç¿’ã—ã¾ã™ã€‚

. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€3ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™:
** Option 1: Developer UIã‚’ä½¿ç”¨ã—ã¦é–‹å§‹ã™ã‚‹
.. ãƒ–ãƒ©ã‚¦ã‚¶ã§ OpenShift Console ã® URL ã‚’å‚ç…§ã™ã‚‹ã€‚
.. æä¾›ã•ã‚ŒãŸèªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚
.. ã¾ã é–‹ç™ºè€…ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ã«ã„ãªã„å ´åˆã¯ã€å·¦ä¸Šã®é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã«Developerã‚’é¸æŠã—ã¾ã™ã€‚
+
image:images/lab4-devsecops04.png[200,200]
+
.. ocp-workshop "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops05.png[200,200]
+
.. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® 'Pipelines' ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops06.png[400,700]
+
.. " petclinic-build-dev "ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops07.png[600,800]
+
.. å³ä¸Šã® â€œActionsâ€ ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ â€œstartâ€ ã‚’é¸æŠ
+
image:images/lab4-devsecops08.png[200,700]
+
.. "Workspaces"ã§PVCã‚’é¸æŠã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œæ™‚ã«ä½¿ç”¨ã™ã‚‹å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‘ã‚¹ã¨ã—ã¦PVC petclinic-build-workspaceã‚’é¸æŠã—ã¾ã™ã€‚
.. "maven-settings" ã§ã€ŒConfig Mapã€ã‚’é¸æŠã—ã€"maven-settings" ã‚’Config Mapã¨ã—ã¦é¸æŠã—ã¾ã™ã€‚
.. start ã‚’ã‚¯ãƒªãƒƒã‚¯
+
** Option 2: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’èµ·å‹•ã™ã‚‹ã€‚
ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ãƒ†ã‚¹ãƒˆä¸­ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã®ã«ä¾¿åˆ©ãªæ–¹æ³•ã§ã€PRã‚„gitã¸ã®pushã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’èµ·å‹•ã•ã›ã‚‹æ–¹æ³•ã§ã™ã€‚CLIã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã®ãŒå¥½ããªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã§ã™ã€‚
+
.. å®Ÿè¡Œ:
+
[source]

|===
|oc create -f https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/pipeline-build-dev-run.yaml -n ocp-workshop

|===
+
** Option 3: æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒgit repoã«pushã•ã‚Œã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã«ã‚‚ãªã‚Šã¾ã™ã€‚ã“ã®ãƒ©ãƒœã§ã¯ã€git repo ã¯ Gogs ã§ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã¯ã€ã€ŒGogsã€git repoçµŒç”±ã§ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚
ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€é–‹ç™ºè€…ã®è¦³ç‚¹ã‹ã‚‰ã™ã‚‹ã¨æœ€ã‚‚ãƒãƒ”ãƒ¥ãƒ©ãƒ¼ãªã‚‚ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚PR ã‚„ git ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå§‹ã¾ã‚Šã€webhook ãŒè‡ªå‹•çš„ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚
+
.. é–‹ç™ºã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã€å·¦ã®ãƒŠãƒ“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹ `Search` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. 'route'ã¨å…¥åŠ›ã—ã€ãƒªã‚¹ãƒˆã®ä¸­ã‹ã‚‰`Route`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops09.png[400,400]
+
.. `Gogs` ãƒ«ãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€gogs ã® URL ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:
+
image:images/lab4-devsecops10.png[400,600]
+
.. `Sign In`ã‚µã‚¤ãƒ³ã‚¤ãƒ³`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€_gogsadmin_ã®èªè¨¼æƒ…å ±ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops11.png[500,400]
+
|===
|User: gogsadmin
|Password: openshift
|===
+
.. gogsadminã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®spring-petclinicãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠã—ã¾ã™:
+
image:images/lab4-devsecops12.png[400,700]
+
.. README.mdã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`Edit this file`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€å¤‰æ›´ã‚’åŠ ãˆã¦ãã ã•ã„:
+
image:images/lab4-devsecops13.png[400,700]
+
.. å°å…¥ã—ãŸå¤‰æ›´ã‚’README.mdã«ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™:
+
image:images/lab4-devsecops14.png[400,700]
+
[æ³¨æ„] ã“ã‚Œã¯ã‚ãã¾ã§ãƒ‡ãƒ¢ã®ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚é€šå¸¸ã€master ã¸ã® push ã¯æ¨å¥¨ã•ã‚Œãšã€ä»£ã‚ã‚Šã«ä»–ã®ãƒ–ãƒ©ãƒ³ãƒ (ä¾‹ãˆã° develop) ã‹ã‚‰ã® Pull Request / Merge Request ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
+
.. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ©ãƒœã®ã‚¹ãƒ†ãƒƒãƒ— 6 ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã€Pipeline Runs ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
+
. æä¾›ã•ã‚ŒãŸOpenShiftã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®URLã‚’ä½¿ã£ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ãã¾ã™ã€‚
. æä¾›ã•ã‚ŒãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
. `Developer`ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€é–‹ç™ºè€…ç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚
+
image:images/lab4-devsecops04.png[200,200]
+
. `OCP-Workshop`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
+
image:images/lab4-devsecops15.png[300,300]
+
. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® `Pipelines` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops16.png[400,700]
+
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® `petclinic-build-dev` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`Pipeline Runs` ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops17.png[400,700]
+
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
èµ·å‹•ã™ã‚‹ã¨ä¸‹å›³ã®ã‚ˆã†ãªPipeline RunãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€ã”è¦§ãã ã•ã„ã€‚
+
image:images/lab4-devsecops18.png[500,700]
+
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã®ã‚¹ãƒ†ãƒƒãƒ—ã€Œimage-checkã€ã§å¤±æ•—ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹é‡è¦ãªæ·±åˆ»åº¦ã®è„†å¼±æ€§ãŒãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆãƒãƒªã‚·ãƒ¼ã«å¼•ã£ã‹ã‹ã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤ãŒåœæ­¢ã™ã‚‹ãŸã‚ã§ã™ã€‚
+
image:images/lab4-devsecops20.png[500,700]
+
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ­£å¸¸ã«å®Œäº†ã•ã›ã‚‹ãŸã‚ã«ã¯ã€ã“ã®è„†å¼±æ€§ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã‚Œã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€æ­£å¸¸ã«å®Ÿè¡Œã•ã‚ŒãŸå ´åˆã®æ§˜å­ã§ã™ã€‚
+
image:images/lab4-devsecops19.png[500,700]
+
æ¬¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€Lab 4.2ã§ã¯ã€ä½•ãŒèµ·ã“ã£ãŸã®ã‹ã€ãã‚Œã‚’å®‰å…¨ã«è§£æ±ºã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
+
[æ³¨æ„] æ‰‹å‹•ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã«åŠ ãˆã€Gogs gitã‚µãƒ¼ãƒãƒ¼ä¸Šã®spring-petclinic gitãƒªãƒã‚¸ãƒˆãƒªã«pushã™ã‚‹ãŸã³ã«ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ¢ç´¢ã—ã‚ˆã†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒé–‹å§‹ã•ã‚Œã‚‹ã¨ã€å„è©³ç´°ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ­ã‚°ã‚’æ¢ç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã®æ•°ã‚¹ãƒ†ãƒƒãƒ—ã§æ¢ç´¢ã®ä¸€éƒ¨ã‚’æŒ‡ç¤ºã—ã¾ã™ã€‚
.. *Source Clone* - ã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã“ã®ãƒ©ãƒœã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹Gitï¼ˆGogsï¼‰ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å¼•ãå‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚
+
[æ³¨æ„] ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã‚ã‚‰ã‹ã˜ã‚è¨­å®šã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä»‹ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¹ãƒ†ãƒƒãƒ—é–“ã§æŒç¶šã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops24.png[400,700]
+
... git repo ã® URL ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã‚’é–‹ã„ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’æ¢ç´¢ã™ã‚‹
... URLã¯ä»¥ä¸‹ã®ã‚ˆã†ã«Gogsã®git repoã«ç§»å‹•ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops25.png[600,700]
+
... `gogsadmin`ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã“ã®ãƒ©ãƒœã®ãŸã‚ã®2ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚Šã¾ã™ã€‚
+
gogsadminãƒ¦ãƒ¼ã‚¶ã®èªè¨¼æƒ…å ±ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:
+
|===
|User: gogsadmin
|Pass: openshift
|===
+
.. *Dependency Report* ã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ãƒ—ãƒªã®ä¾å­˜é–¢ä¿‚ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã€ãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚
+
image:images/lab4-devsecops26.png[300,700]
+
reportã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†!
+
... é–‹ç™ºã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã€å·¦ã®ãƒŠãƒ“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹ `Search` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
... Resourcesã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`route`ã¨å…¥åŠ›ã€ãƒªã‚¹ãƒˆã‹ã‚‰`Route`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops09.png[400,400]
+
... reports-repo ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚
+
image:images/lab4-devsecops27.png[300,700]
+
... ã“ã®ãƒšãƒ¼ã‚¸ã® `petclinic-build` ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops28.png[300,500]
+
... å¼•ãç¶šãã€spring-petclinic â†’ target â†’ site ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
... ãã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ `Dependencies` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ãã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§è©³ç´°ã‚’èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
+
image:images/lab4-devsecops29.png[300,700]
+
.. *Unit tests* ã‚¿ã‚¹ã‚¯ã¯ã€ä¾å­˜æ€§ãƒ¬ãƒãƒ¼ãƒˆã¨ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops30.png[300,700]
+
. *Release-app* ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’JARã¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã€Sonatype Nexusã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å ´æ‰€ã§ã™ã€‚
+
image:images/lab4-devsecops31.png[300,700]
+
. *Build-image* ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€DEVç’°å¢ƒã§S2Iã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€OpenShiftã®å†…éƒ¨ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã€spring-petclinic:[branch]-[commit-sha] ãŠã‚ˆã³ spring-petclinic:latest ã§ã‚¿ã‚°ä»˜ã‘ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops32.png[300,700]

=== Lab 4.2 Advanced Cluster Securityã‚’åˆ©ç”¨ã—ãŸDevSecOpsã®ã‚¹ãƒ†ãƒƒãƒ—

Red Hat Advanced Cluster Security (ACS) for Kubernetes ã¯ã€ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã«ã‚ˆã‚Šã€å˜ä¸€ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚ +
ç¬¬ä¸€ä¸–ä»£ã®ã‚³ãƒ³ãƒ†ãƒŠã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚ACSã¯Kubernetesã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ãŠã‚Šã€Kubeã®å®£è¨€å‹ãƒ‡ãƒ¼ã‚¿ã¨ãƒ“ãƒ«ãƒˆã‚¤ãƒ³åˆ¶å¾¡ã‚’æ´»ç”¨ã—ãŸKubernetesãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€ãƒªãƒƒãƒãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€ãƒã‚¤ãƒ†ã‚£ãƒ–ãªå®Ÿæ–½ã€ç¶™ç¶šçš„ãªãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã€DevOpsã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨ã‚’æ”¯æ´ã—ã¾ã™ã€‚ã•ã‚‰ã«ã€ACS focuses on Kubernetesã¯ã€DevOpsãŠã‚ˆã³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’é‹ç”¨ã§ãã‚‹ã‚ˆã†æ”¯æ´ã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä¿è­·ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç°¡ç´ åŒ–ã—ã¾ã™ã€‚

ã“ã®ãƒ©ãƒœã§ã¯ã€ACS ãŒ CI/CD ãƒ—ãƒ­ã‚»ã‚¹ã«ã©ã®ã‚ˆã†ã«çµ±åˆã•ã‚Œã‚‹ã‹ã‚’å­¦ã³ã¾ã™ã€‚ACSã¯ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç°¡ç´ åŒ–ã™ã‚‹ã ã‘ã§ãªãã€çµ„ç¹”å†…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã«å¯è¦–æ€§ã‚’æä¾›ã—ã¾ã™ã€‚
 https://docs.openshift.com/acs/cli/getting-started-cli.html[roxctl] ACS API ã‚’ä½¿ã£ã¦ã€ã„ãã¤ã‹ã®è¿½åŠ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ãƒ†ãƒƒãƒ—ã‚’ DevSecOps ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ±åˆã—ã¾ã—ãŸ:

. *image scan* ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ACSã‚¹ã‚­ãƒ£ãƒŠã‚’ä½¿ç”¨ã—ã¦ã€æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§ç”Ÿæˆã•ã‚Œã€ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops33.png[300,700]
+
ãƒ­ã‚°ã«ã‚ã‚‹ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã¯ã€`pretty` ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒéæ¨å¥¨ã§ã‚ã‚‹ã“ã¨ãŒåŸå› ã§ã™ã€‚
+
|===
|ERROR:	invalid output format "pretty" used. You can only specify json or csv
|===
+
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§è¡Œã„ã¾ã™ã€‚

.. å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ `Pipelines` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `petclinic-build-dev` ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `Actions` -> `Edit Pipeline`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. `image-scan` ã‚¿ã‚¹ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€`pretty` ã®ä»£ã‚ã‚Šã« `csv` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
+
image:images/lab4.2-image-scan.png[500,700]
+
.. `Save`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
.. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ `Actions` -> rerun ã‚’é¸æŠã™ã‚‹ã¨ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã®å®Ÿéš›ã®å‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:images/lab4.2-image-scan-withlogs.png[500,700]
+
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ­ã‚°ã«ã¯ã€ACSã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã¸ã®ç›´æ¥ã®ãƒªãƒ³ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
+
[æ³¨æ„] ã‚‚ã—ã€ãã®ãƒªãƒ³ã‚¯å…ˆã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨¼æ˜æ›¸ã®è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‚ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚ +
ã‚³ãƒ”ãƒ¼ã—ã¦åˆ¥ã®ã‚¿ãƒ–ã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã€ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã®è©³ç´°ãªæƒ…å ±ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:
+
|===
|User: admin
|Pass: stackrox
|===
+
URLã¯ã€Vulnerability Managementã«ç§»å‹•ã—ã¾ã™ã€‚ã“ã®ç”»åƒã«å«ã¾ã‚Œã‚‹è„†å¼±æ€§(CVE)ã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops35.png[500,700]
+
.. Deployment ã‚¿ãƒ–ã§ã€ACSãƒ„ãƒ¼ãƒ«ã¯ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’èªè­˜ã—ã¾ã™ã€‚æœ€åˆã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã™ã¹ã¦ã®ã‚²ãƒ¼ãƒˆã‚’é€šéã—ãªã‹ã£ãŸã®ã§ã€æœ€åˆã¯ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„ã§ã—ã‚‡ã†ã€‚


.. Component ã‚¿ãƒ–ã¯ã€ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã®ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ“ãƒ¥ãƒ¼ã§ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ä¿®æ­£å¯èƒ½ãª CVE ã®æ•°ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® CVE ã«é–¢é€£ã™ã‚‹ CVSS ã‚¹ã‚³ã‚¢ã®ãƒˆãƒƒãƒ—ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å«ã‚€ä»–ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãªã©ã®é–¢é€£æƒ…å ±ãŒä¸€è¦§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

+
image:images/lab4-devsecops34.png[500,700]
+
ä¾‹ãˆã°ã€tomcat 9.0.31 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä¸‹å›³ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯ã€ãƒªã‚¹ã‚¯ã®å„ªå…ˆé †ä½ã€CVE ã®æƒ…å ±ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å ´æ‰€ã€CVE ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:images/lab4.2-tomcat-cve.png[500,700]
+
.. å³ä¸Šã® â€œXâ€ ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æˆ»ã‚‹ã“ã¨ãŒã§ãã¾ã™
.. CVEsã‚¿ãƒ–ã¯ã€ç”»åƒã®ã™ã¹ã¦ã®è„†å¼±æ€§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
+
image:images/lab4-devsecops36.png[500,700]
+
.. `Overview` ã‚¿ãƒ–ã«æˆ»ã‚Šã€`Image findings` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã™ã‚‹ã¨ã€ä¿®æ­£å¯èƒ½ãª CVE ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€ACS ãŒä¿®æ­£å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜ã—ã¦ã„ã‚‹ CVE ã§ã™ã€‚
+
image:images/lab4-devsecops37.png[300,700]
+
.. `Image Findings`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸Šã«ã‚ã‚‹ `Dockerfile` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ '>' ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹ã™ã‚‹ã¨ã€ACS CVEãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã‚Šã€å„ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«è©³ç´°ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨é–¢é€£ã™ã‚‹CVEãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops38.png[400,700]
+
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å¾©ç¿’ã‚’ç¶šã‘ã‚‹å‰ã«ã€ACSã®æ¢ç´¢ã‚’è‡ªç”±ã«è¡Œã£ã¦ãã ã•ã„ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã¨ãƒ„ãƒ¼ãƒ«ã®æ©Ÿèƒ½ã‚’ç†è§£ã™ã‚‹ã“ã¨ã¯ã€ã“ã®ãƒ©ãƒœã®é‡è¦ãªéƒ¨åˆ†ã§ã‚ã‚Šã€å®‰å…¨ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é…ä¿¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®çŸ¥è­˜ã‚’é«˜ã‚ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚
+
ã“ã“ã§ã€OpenShift Developerã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚
. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® *Image Check* ã‚¹ãƒ†ãƒƒãƒ—
+
[æ³¨æ„] ACSã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹æ§˜ã€…ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®ãƒ“ãƒ«ãƒ‰æ™‚ã®é•å
+
image:images/lab4-devsecops39.png[400,700]
+
image:images/lab4-devsecops40.png[400,700]
+
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦ã€ACS ã§å®šç¾©ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒãƒªã‚·ãƒ¼ã®ãƒ“ãƒ«ãƒ‰æ™‚ãŠã‚ˆã³ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®é•åã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼é•åã®ãŸã‚ã€ACSã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®å®Ÿæ–½ã‚’è¨­å®šã—ãŸãŸã‚ã€ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã“ã®ã‚¿ã‚¹ã‚¯ã§å¤±æ•—ã—ã¾ã™ã€‚
è„†å¼±æ€§ã®é«˜ã„ã‚³ãƒ³ãƒ†ãƒŠå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹ã—ãªã„ãŸã‚ã«ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¹ã‚­ãƒ£ãƒ³ãŒé‡è¦ã§ã™ã€‚

. *Deploy-check* ã¯ã€ãƒ­ã‚°ã«ãƒãƒªã‚·ãƒ¼ã®é•åãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ­ã‚°ã«ã¯é•åãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã®ä¾‹ã§ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã®å¼·åˆ¶ãŒã‚ªãƒ³ã«ãªã£ã¦ã„ãªã„ãŸã‚ã€ã“ã®ã‚¿ã‚¹ã‚¯ã§å¤±æ•—ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã®å¾Œã®ãƒ©ãƒœã§ã€ãƒãƒªã‚·ãƒ¼ã®è©³ç´°ã‚’ç¢ºèªã—ã¾ã™ã€‚
+
image:images/lab4-devsecops41.png[400,700]
+
[æ³¨æ„] ã“ã®3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ*deploy-check, image-check, image-scan*ï¼‰ã¯ã€DevSecOpsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ™‚é–“çŸ­ç¸®ã®ãŸã‚ã«ä¸¦è¡Œã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
+
. ã‚‚ã— *image-check* ãŒå¤±æ•—ã—ãŸã‚‰ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œã«ç§»å‹•ã—ã¦ `image-check` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ãƒ­ã‚°ã®ä¸€ç•ªä¸‹ã« `Error: failed policies found: 1 policy violated that are failing the check.` ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¯ã€é•åãŒç™ºç”Ÿã—ãŸå ´åˆã« ACS ãŒãƒ“ãƒ«ãƒ‰ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ã‹ã‚‰ãƒãƒªã‚·ãƒ¼ã‚’å¼·åˆ¶ã™ã‚‹ãŸã‚ã§ã™ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€Tektonã‚¿ã‚¹ã‚¯ã®roxctlã‚’ä»‹ã—ã¦ACSã‚’çµ±åˆã—ã¦ã„ã¾ã™ã€‚
+
ImageãŒãƒãƒªã‚·ãƒ¼ã«é•åã—ãŸå ´åˆã€ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã€ãƒã‚§ãƒƒã‚¯ã«åˆæ ¼ã™ã‚‹ã¾ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚ãƒ­ã‚°ã«ã¯é•åã®ä¸€è¦§ã¨å¯¾å‡¦æ³•ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚é–‹ç™ºè€…ã¯ `image-check` ã‚¿ã‚¹ã‚¯ã®ãƒ­ã‚°ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã€ãã‚Œã«å¿œã˜ã¦å¤‰æ›´ã‚’åŠ ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¿®æ­£ãŒGitã«ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã•ã‚Œã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚ä»Šå›ã€xref:fiximage[ç”»åƒã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã®ãƒœãƒ¼ãƒŠã‚¹ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º]ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚ã‚‚ã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä¸Šã§ä»–ã®ã‚¿ã‚¹ã‚¯ã®ãƒ†ã‚¹ãƒˆã‚’ç¶šã‘ãŸã„å ´åˆã¯ã€ãƒãƒªã‚·ãƒ¼ã«ä¾‹å¤–ã‚’è¿½åŠ ã—ã¦ã€spring-petclinicã‚’é™¤å¤–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãƒãƒªã‚·ãƒ¼ã«ä¾‹å¤–ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯ã€é–‹ç™ºè€…ãŒã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€CIãƒ—ãƒ­ã‚»ã‚¹ãŒãƒ†ã‚¹ãƒˆã‚’ç¶™ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«æœ‰åŠ¹ã§ã‚ã‚‹ã€‚
+
[æ³¨æ„] é•åãŒé€šã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
+
spring-petclinicãƒ“ãƒ«ãƒ‰ã®ãƒãƒªã‚·ãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ä¾‹å¤–ã‚’è¿½åŠ ã—ãŸã„å ´åˆã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
+
.. *image-check* ã‚¿ã‚¹ã‚¯ã®ãƒ­ã‚°ã‚’èª¿ã¹ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå¤±æ•—ã®åŸå› ã¨ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã™:
+
|===
|âœ— Image image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic@sha256:ece54d2923654c36f4e97bc0410f5c027871c5b7483e977cfc6c2bd56fef625d and '*ERROR: Policy "Fixable Severity at least Important"*'
|===
+
.. `ãƒ¯ãƒƒãƒ•ãƒ«ã‚¢ã‚¤ã‚³ãƒ³` image:images/lab4-devsecops42.png[20,20] ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º â†’ ä»¥ä¸‹ã®ã‚ˆã†ã« `Red Hat Advanced Cluster Security For Kubernetes` ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:images/lab4-devsecops43.png[700,300]
+
.. ACSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã‚ˆã†ä¿ƒã•ã‚Œã¾ã™ â†’ `Advanced` ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ `Proceed to central-stackrox.apps.cluster...` ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é€²ã¿ã¾ã™ã€‚
.. ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:
+
|===
|User: admin
|Pass: stackrox
|===
+
.. ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚
+
image:images/lab4-devsecops44.png[300,700]
+
.. å·¦ä¸Šã® image:images/lab4-devsecops45.png[20,20] ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ Platform Configuration ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ Policies ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:images/lab4-devsecops46.png[100,200]
+
.. Policies ã®ä¸‹ã«ã‚ã‚‹æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã€ãƒãƒªã‚·ãƒ¼å *Fixable Severity at least Important* ã‚’å…¥åŠ›ã—ã€Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚çµæœã€ãƒãƒªã‚·ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops47.png[300,700]
+
[æ³¨æ„] UIä¸Šã§ https://issues.redhat.com/browse/ROX-9938[bug] ã«é­é‡ã—ãŸãŸã‚ã€ACS UIçµŒç”±ã§ãƒãƒªã‚·ãƒ¼ã«ãƒ“ãƒ«ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¾‹å¤–ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ããªããªã‚Šã¾ã™ã€‚ã“ã“ã§ã®æ‰‹é †ã¯ã€å›é¿ç­–ã§ã™ã€‚ACS v3.70ã§ã¯ã€SHAãªã—ã§UIçµŒç”±ã§ãƒ“ãƒ«ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
+
* `Fixable Severity at least Important` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒãƒªã‚·ãƒ¼ã®è©³ç´°ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒãƒªã‚·ãƒ¼ãƒšãƒ¼ã‚¸ã§ã¯ã€`Actions` ã®ä¸‹ã§ãƒãƒªã‚·ãƒ¼ã®ç·¨é›†ã€ã‚¯ãƒ­ãƒ¼ãƒ³ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ç„¡åŠ¹åŒ–ãŒã§ãã¾ã™ã€‚`Actions` ã®ä¸‹ã«ã‚ã‚‹ 'Clone policy' ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚é–‹ç™ºè€…ã¯ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã®æƒ…å ±ã‚’ä½¿ã£ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ã®æƒ…å ±ã¯ã€ãƒãƒªã‚·ãƒ¼ã®å¼·åˆ¶ãŒè¡Œã‚ã‚Œã‚‹å ´æ‰€ã§ã™ã€‚æœ‰åŠ¹ãªãƒãƒªã‚·ãƒ¼ã«é•åã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é€šéã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
+
image:images/lab4-devsecops48.png[300,700]
+
* ã‚¯ãƒ­ãƒ¼ãƒ³ãƒãƒªã‚·ãƒ¼åã‚’ `Fixable Severity at least Important - with Exception` ã¨å…¥åŠ›ã—ã¾ã™ã€‚
+
image:images/lab4.2-5-clone-policy-name.png[300,700]
+
* `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* ãƒãƒªã‚·ãƒ¼ã®å‹•ä½œã§ `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* ç”»åƒã‚’é™¤å¤–ã™ã‚‹ãŸã‚ã«ã€Policy criteria ã® `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€Policy scope ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® UI ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
* Exclude imagesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€`Excluded Images (Build Lifecycle only)` ãƒªã‚¹ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã‚’ã‚¿ã‚¤ãƒ—ã—ã¾ã™:
+
|===
|image-registry.openshift-image-registry.svc:5000/ocp-workshop/spring-petclinic
|===
+
* spring-petclinic ã®Imageã‚’1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚
+
image:images/lab4.2-5-exclude-image.png[300,700]
+
* `Next` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* `Save` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹å‰ã«ã€ãƒãƒªã‚·ãƒ¼ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
* ã“ã“ã§ã€æ–°ã—ãä½œæˆã—ãŸ Imageä¾‹å¤–ãƒãƒªã‚·ãƒ¼ `Fixable Severity at least Important - with Exception` ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® `Policies` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* `Fixable Severity at least Important - with Exception` ã®ãƒãƒªã‚·ãƒ¼ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚
+
image:images/lab4.2-5-exceptionPolicy.png[300,700]
+
* ãƒãƒªã‚·ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* Actions ã‚’ã‚¯ãƒªãƒƒã‚¯ -> Export policy to JSON ã‚’ã‚¯ãƒªãƒƒã‚¯
+
image:images/lab4.2-5-exportPolicy.png[300,700]
+
* é¸æŠã—ãŸãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
* JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠå¥½ã¿ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ãã¾ã™ã€‚
+
image:images/lab4.2-5-editPolicy.png[300,700]
+
* Imageåã‹ã‚‰ `@sha256:..` ä»¥é™ã®SHAéƒ¨åˆ†ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
+
image:images/lab4.2-5-editpolicy2.png[300,700]
+
* ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ã€‚
* ACS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«æˆ»ã‚Šã€ `Fixable Severity at least Important - with Exception` ãƒãƒªã‚·ãƒ¼è©³ç´°ãƒšãƒ¼ã‚¸ã§ã€ `Actions` -> `Delete policy` ã‚’é¸æŠã—ã¾ã™ã€‚
* å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® `Policies` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* å³ä¸Šã® `Import policy` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* `Upload` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ç·¨é›†ã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:images/lab4.2-5-importPolicy.png[200,500]
+
* `Begin import` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
* ãƒãƒªã‚·ãƒ¼ 'Fixable Severity' ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
+
image:images/lab4.2-5-filterPolicy.png[300,700]
+
* `Fixable Severity at least Important` ã®æœ«å°¾ã®3ç‚¹ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ -> select `Disable policy` ã‚’é¸æŠã—ã¾ã™ã€‚
+
image:images/lab4.2-5-disablePolicy.png[300,700]
+
.. ã“ã‚Œã§ã€`Fixable Severity`ã®ãƒãƒªã‚·ãƒ¼ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
+
image:images/lab4.2-5-2Policy.png[300,700]
+
.. OpenShift developer console ã«æˆ»ã‚Šã€ãƒŠãƒ“ã® â€œocp-workshopâ€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸‹ã«ã‚ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops52.png[300,700]
+
.. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚
+
image:images/lab4-devsecops53.png[300,700]
+
.. Pipeline Runsã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€é–‹å§‹ã—ãŸPipeline Runã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
+
image:images/lab4-devsecops54.png[300,700]
+
image:images/lab4-devsecops55.png[300,700]
+
.. xref:fiximage[bonus lab] ã§Imageã‚’ä¿®æ­£ã—çµ‚ãˆãŸã‚‰ã€ãƒãƒªã‚·ãƒ¼ã«æˆ»ã£ã¦ã€ãƒãƒªã‚·ãƒ¼ã®ä¾‹å¤–ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

.. Kubernetes kustomization ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€*update deployment step* ã§ã€devç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«ã‚ã‚‹æœ€æ–°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ [commit-sha] ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç§ãŸã¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ç‰¹å®šã®ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚
+
image:images/lab4-devsecops56.png[300,700]


=== Lab 4.3 Continuous Delivery Using GitOps

GitOps is a declarative way to implement continuous deployment for cloud-native applications. We can use GitOps to create repeatable processes for managing OpenShift Container Platform clusters and applications across multi-cluster Kubernetes environments. GitOps handles and automates complex deployments at a fast pace, saving time during deployment and release cycles. +
The GitOps workflow pushes an application through development, testing, staging, and production. GitOps either deploys a new application or updates an existing one, so we only need to update the repository; GitOps automates everything else.

Argo CD continuously monitors the configurations stored in the Git repository and uses Kustomize to overlay environment-specific configurations when deploying the application to DEV and STAGE environments.

image:images/lab4-devsecops57.png[300,700]

. The ArgoCD application syncs the manifests in our Gogs git repositories, and applies the changes automatically into the namespaces defined:
.. Click on the waffle icon on the top to get to the console links and select â€œCluster Argo CDâ€
+
image:images/lab4-devsecops43.png[300,300]
+
.. The link redirects to the Argo CD login. If it is the first time logging in to Argo CD, please click `Advanced` â†’ `Proceed to openshift-gitops-server-openshift-gitops.appsâ€¦` link.
.. In order to be able to log in as an "admin" user, please first retrieve its password by running the command as shown below.
+
[source]
----
oc get secret/openshift-gitops-cluster -n openshift-gitops -o jsonpath='{.data.admin\.password}' | base64 -d
----
+
.. Once logged in, the applications are listed on the Argo CD console as shown below.
+
image:images/lab4-devsecops58.png[500,600]
+
.. Click onto `dev-spring-petclinic` to access the application.
. ArgoCD will deploy every manifest that is defined in the branch/repo of our application. The application shows â€œSyncedâ€.
+
image:images/lab4-devsecops59.png[300,700]
+
.. Click image:images/lab4-devsecops101.png[100,90] to view the details of the `dev-spring-petclinic` application.
+
image:images/lab4-devsecops102.png[900,700]
+
.. The details above show the namespace where the application is deployed. Back to the OpenShift Dev console, click `Topology` on the left navigation menu under devsecops-dev project. Click the arrow to access the application URL.
+
image:images/lab4-devsecops60.png[300,500]
+
* Application shows as below.
+
image:images/lab4-devsecops61.png[500,500]
+
.. Go back to the Argo CD console. Click `Applications` on the top left.
+
[Note] The namespace for `stage-spring-petclinic` is set to devsecops-qa.
+
image:images/lab4-devsecops62.png[300,300]
+
.. Click `stage-spring-petclinic`
+
image:images/lab4-devsecops63.png[300,700]
+
.. Click image:images/lab4-devsecops64.png[40,50] on the top menu to deploy the application to devsecops-qa and wait until â€œSyncedâ€ as shown below.
+
image:images/lab4-devsecops65.png[300,700]
+
.. Back to the OpenShift Dev console, click `Topology` on the left navigation menu under devsecops-qa project. Click the arrow to access the application URL.
+
image:images/lab4-devsecops66.png[300,300]
+
.. The application is now deployed to the devsecops-qa project as shown below.
+
image:images/lab4-devsecops67.png[300,500]

=== Lab 4.4 PostCI - Dynamic Application Security and Testing (DAST)

*Dynamic application security testing (DAST)* is designed to detect conditions indicative of a security vulnerability in an application in its running state. DAST has an important role in helping to identify vulnerabilities in an application during production. Running a DAST penetration test enables us to find those vulnerabilities before an attacker does.
In this lab, ZAP is used to perform application security testing as an example. Performance tests and penetration tests start in parallel after the application is promoted from Dev to QA.

. Our CI in Openshift Pipelines waits until the ArgoCD app is fully synced (*Wait Application step*) and our app and all the resources are deployed
.. Go to the successful pipeline run, and go to the step *wait-application*
+
image:images/lab4-devsecops68.png[300,700]
+
.. Click onto the step, the log is shown below.
+
This step authenticates into an ArgoCD instance and initiates the synchronization process for 'dev-spring-petclinic' application from Git repo (gogs) to the target project in the OCP cluster.
+
image:images/lab4-devsecops69.png[300,700]
+
. Click on the pipeline the step *perf-test-clone*
+
The performance tests are cloned (*Performance Tests Clone*) into our pipeline workspace as shown below.
+
image:images/lab4-devsecops70.png[300,700]
+
. Click onto step *pentesting-test*
+
The pentesting is executed (*Pentesting Test*) using the web scanner https://www.zaproxy.org/[OWASP Zap Proxy] using a baseline to check the possible vulnerabilities. A Zap Proxy report is uploaded to the report server repository.
See the result from the bottom of the log.
+
image:images/lab4-devsecops72.png[300,700]
+
. A performance report is uploaded to the report server repository.
.. Click `Route` on the left navigation, click `reports-repo` route location.
+
image:images/lab4-devsecops73.png[300,700]
+
.. The link has the name that corresponds to the name of the PipelineRun.
.. Please click on the link with the same name as the PipelineRun. A similar link is shown below.
+
image:images/lab4-devsecops75.png[300,400]
+
.. Go to petclinic-build-dev-XXXXXX.html under the route location
+
image:images/lab4-devsecops76.png[300,700]
+
. In parallel, the performance tests are executed using the load test https://gatling.io/[Gatling]. Click â€œperformance-testâ€ from the pipeline run.
+
image:images/lab4-devsecops77.png[300,700]
+
.. Scroll down to see the report location
+
image:images/lab4-devsecops78.png[300,700]
+
.. Go back to the report repo location:
+
image:images/lab4-devsecops79.png[300,400]
+
.. Click on the link that matches the name of Pipeline Run, then select the link corresponding to the "addvisitsimulation" performance test that is also shown in the `performance-test` task log.
+
image:images/lab4-devsecops80.png[200,400]
+
.. Please see the result of the performance test page similar to the image below.
+
image:images/lab4-devsecops81.png[400,700]


=== Lab 4.5 Security Policies and CI Violations

In this demo, we can control the security policies applied to our pipelines, scan the images, and analyze the different deployment templates used to deploy our applications. +
We can enforce the different Security Policies in ACS, failing our CI pipelines if a violation of this policy appears in each step of our DevSecOps pipelines (steps â€œimage-checkâ€, â€œimage-scanâ€, â€œdeploy-checkâ€).

* Click on the `waffle icon` and select `Red Hat Advanced Cluster Security for Kubernetes`
+
image:images/lab4-devsecops43.png[300,300]
+
* Log in using credential admin/stackrox to ACS console.
+
image:images/lab4-devsecops82.png[300,700]
+
* Click Platform Configuration â†’ Policies
+
image:images/lab4-devsecops83.png[200,200]
+
Security Policies can be defined at the BUILD level (during the build/push of the image), or at the DEPLOYMENT level (preventing the deployment of the application).
* Click on the Package manager policy
+
image:images/lab4-devsecops84.png[300,700]
+
For example, this Security Policy checks if an RH Package Manager (dnf, yum) is in the application Image and will FAIL the pipeline if it detects that the image built contains any RH Package Manager.
* The policy details can be modified. Also, the lifecycle stages are defined by the policy and other properties. The enablement of the Policy option is where the user controls the CI to fail or pass.
+
image:images/lab4-devsecops85.png[300,700]
+
* Click `Actions` -> `Edit policy`
* Click `Next` on `Policy details`
* Select `Inform and enforce` under Response method
* Select `Enforce on Build` for Build
+
image:images/lab4-devsecops87.png[300,700]
+
* Click `Next`, `Next`, `Next` and `Save`
This step ensures that users  have total control of the pipelines. No image is pushed into the image registry or is deployed to the cluster that surpasses the defined Security Policies.


[#fiximage]
=== Bonus suggestion for Lab 4.2: Fixing the image

To show a complete demo and show the transition from a `bad image` to an image that passes the build enforcement, we can update the Tekton task of the image build and fix the image.
In this example, we will be enabling the enforcement of the `Red Hat Package Manager in Image` policy in ACS, which will fail our pipeline at the image-check as both yum and rpm package managers are present in our base image.

. Add an exception to bypass the violation in the *Fixable Severity at least important* policy as we did in the previous section.
. Enable enforcement of the *Red Hat Package Manager in Image* policy:
.. Go to `Platform Configuration` â†’ `Policies`
.. Search for `Red Hat Package Manager in Image` policy
+
image:images/lab4-devsecops88.png[300,700]
+
.. Click onto the `Red Hat Package Manager in Image` policy
.. Click `Actions` -> `Edit policy`
.. Click `Next`
.. Select `Inform and enforce`
.. Ensure select `Enforce on Build` in Build under `Configure enforcement behavior`
+
image:images/lab4-devsecops87.png[300,600]
+
.. Click `Next` until reaching `Review policy` page
.. Click `Save` (if any modification apply)
.. Go to the OpenShift Dev UI, click Pipelines on the left â†’ click `petclinic-build-dev` pipeline â†’ click Actions on the top right corner â†’ select `Start last run`
+
image:images/lab4-devsecops91.png[300,700]
+
.. Check and confirm that it fails on the *image-check* step as the image has the "rpm" and "yum" package managers installed. Notice the suggestion from the *image-check* step:
+
image:images/lab4-devsecops92.png[300,700]
+
.. We will effectively update the image with this remediation suggestion.
. Instead of updating the `s2i-java-11` Tekton task, we are replacing the task.
.. From the OpenShift Administrator UI, make sure the ocp-workshop project is selected before going to Pipelines > Tasks and delete the s2i-java-11 task.
+
image:images/lab4-devsecops93.png[300,700]
+
.. With the Tekton cli
+
|===
|tkn task delete s2i-java-11
|===
+
. Apply the new update task from the command terminal:
+
|===
|kubectl apply -f https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml --namespace=ocp-workshop
|or,
|oc apply -f https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml  -n ocp-workshop
|===
+
. Re-run the pipeline, the deployment now succeeds. Congratulations to the developers!
. The pipeline run result will be similar to the one below.
+
image:images/lab4-bonus-result.png[300,700]
+
[Note] Please check the https://raw.githubusercontent.com/RedHatDemos/SecurityDemos/master/2021Labs/OpenShiftSecurity/documentation/labs-artifacts/s2ijava-mgr.yaml[*labs-artifacts/s2ijava-mgr.yaml]*** **file for more details on how the image was fixed. We have added a step to the build task, and we leverage buildah to remove the package managers from the image (search for "rpm" or "yum" in the file).
+
image:images/lab4-devsecops94.png[300,700]

=== Bonus exercise: Temporarily Snoozing CVEs

If we just want to snooze a particular CVEs instead of fixing the image and adding an exception to the policy for the build. ACS allows users to temporarily disable the CVEs for a period of time.

[Note] Snoozing the CVEs will temporarily disable the CVEs for all policies.

For this lab, we can snooze the CVEs that cause the image-check to fail and continue to build the pipeline. We will see the image-check task is reporting the violations information from the log.


image:images/lab4-devsecops95.png[300,700]

In some situations, we may want to snooze the CVEs for a period of time. Here are the steps:

. Go to the ACS console via the `waffle icon` and click on the `Red Hat Advanced Clustered Security for Kubernetes` link.
Click Vulnerability Management left menu and click on the CVEs button  on the top.
. We can look for the CVEs to snooze and set up snooze by selecting the duration is needed.
+
image:images/lab4-devsecops96.png[300,700]


=== Bonus exercise: Notification

ACS can be integrated with several Notifiers for alerting if certain events happen in the clusters managed. In our case, we integrated with Slack to receive notifications when some Policies are violated to have more useful information:

image:images/lab4-devsecops97.png[300,500]

These policy notifications can be enabled by each system policy enabled in our system, so we can create our own notification baseline in order to have only the proper information received in our systems. +
Here are the steps to set up slack integration with ACS based on the official https://help.stackrox.com/docs/integrate-with-other-tools/integrate-with-slack/[Integrate with Slack] documentation in Stackrox.

. Create a Slack App, enable Incoming Webhooks and get the Webhook URL using instruction https://docs.openshift.com/acs/3.69/integration/integrate-with-slack.html#configure-slack_integrate-with-slack[here]
+
image:images/lab4-slack.png[300,500]
+
. Select `Platform Configuration` -> `Integration`
+
image:images/lab4-devsecops98.png[100,300]
+
. Click `Slack` and Click `New integration`
. Enter Slack App information in the form below.
+
image:images/lab4-slack-int.png[100,300]
+
. Enable the Notifications in the system policies: Select `Platform Configuration` -> `Policies`
. -> Select a Policy -> Click `Actions` -> `Edit policy`
+
image:images/lab4-devsecops99.png[300,700]

=== Troubleshooting

==== Code Analysis Failures

- Issue:
Sometimes Code Analysis raises an error when mvn is running the maven install 'sonar:sonar':

[source]
----
[[1;31mERROR[m] Failed to execute goal+
[32morg.apache.maven.plugins:maven-compiler-plugin:3.8.1:testCompile[m [1m(default-testCompile)[m on
project [36mspring-petclinic[m: [1;31mCompilation failure[m
[[1;31mERROR[m]
[1;31m/workspace/source/spring-petclinic/src/test/java/org/springframework/samples/petclinic/service/ClinicServiceTests.java:[30,51]
cannot access org.springframework.samples.petclinic.owner.Pet[m
[[1;31mERROR[m] [1;31m  bad class file:
/workspace/source/spring-petclinic/target/classes/org/springframework/samples/petclinic/owner/Pet.class[m
[[1;31mERROR[m] [1;31m    class file contains wrong class:
org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest[m
[[1;31mERROR[m] [1;31m    Please remove or make sure it appears in the correct subdirectory of the
classpath.[m
[[1;31mERROR[m] [1;31m[m
[[1;31mERROR[m] -> [1m[Help 1][m
[[1;31mERROR[m]
----

- Resolution:
Just rerun the pipeline and will succeed without changing anything additional. The results will succeed afterward:
[source]
----
[[1;34mINFO[m] Analyzed bundle 'petclinic' with 20 classes+
[[1;34mINFO[m] Analyzed bundle 'petclinic' with 20 classes
[[1;34mINFO[m]
[[1;34mINFO[m] [1m--- [0;32mmaven-jar-plugin:3.1.2:jar[m [1m(default-jar)[m @
[36mspring-petclinic[0;1m ---[m
[[1;34mINFO[m]
[[1;34mINFO[m] [1m--- [0;32mspring-boot-maven-plugin:2.2.5.RELEASE:repackage[m [1m(repackage)[m @
[36mspring-petclinic[0;1m ---[m
[[1;34mINFO[m] Replacing main artifact with repackaged archive
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1;32mBUILD SUCCESS[m
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] Total time: 01:55 min
[[1;34mINFO[m] Finished at: 2021-07-23T07:37:09Z
[[1;34mINFO[m] Final Memory: 118M/1245M
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
----

==== JUnit Tests Failures

Refer to the Code Analysis. Just rerun it. It will fix the error.

====  Failure uploading the zap proxy report into the upload server


After the zap proxy task is executed the upload to the report repo server fails due to wrong folder structure:
[source]
----
+ ls -lhrt /zap/wrk
total 76K

-rw-r--r--. 1 zap zap 75K Aug 20 10:41 petclinic-build-devm9hqv.html
+ echo 'Uploading the report into the report server'
Uploading the report into the report server

+ curl -u reports:reports -F path=petclinic-build-devm9hqv.html -F file=/zap/wrk/petclinic-build-devm9hqv.html -X POST http://reports-repo:8080/upload
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100   335  100    36  100   299   7200  59800 --:--:-- --:--:-- --:--:-- 67000
{"message":"Internal Server Error"}
----

Fix the zap-proxy task and replace the line 99, with the content of the following curl to upload properly
[source]
----
curl -u $(params.REPORTS_REPO_USERNAME):$(params.REPORTS_REPO_PASSWORD) -F path=$PIPELINERUN_NAME/$PIPELINERUN_NAME.html -F file=@/zap/wrk/$PIPELINERUN_NAME.html -X POST $(params.REPORTS_REPO_HOST)/upload; echo ""
----

After that rerun the pipeline and check that effectively the zap proxy report its uploaded to the reports server:
[source]
----
+ curl -u reports:reports -F path=petclinic-build-dev-6f4569/petclinic-build-dev-6f4569.html -F file=@/zap/wrk/petclinic-build-dev-6f4569.html -X POST http://reports-repo:8080/upload
% Total % Received % Xferd Average Speed Time Time Time Current
Dload Upload Total Spent Left Speed

0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0
100 76435 100 89 100 76346 22250 18.2M --:File has been uploaded to petclinic-build-dev-6f4569/petclinic-build-dev-6f4569.html ğŸš€--:-- --:--:-- --:--:-- 18.2M
+ echo ''
----

image:images/lab4-devsecops100.png[300,700]
